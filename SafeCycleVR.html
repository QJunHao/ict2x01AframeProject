<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>SafeCycleVR</title>
    <script src="https://aframe.io/releases/0.5.0/aframe.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-aabb-collider-component@^2.2.1/dist/aframe-aabb-collider-component.min.js"></script>
    <script src="./aabbCollider/EventSet.js"></script>
    <script src="./aabbCollider/Collider.js"></script>
    <script src="carComponent.js"></script>
</head>
<body>
    <a-scene>
        <a-assets>
            <img id = "ground" src="asset/ground.jpg">
            <img id = "car" src="asset/car.png">
            <img id = "road" src="asset/road.jpg">
            <img id = "zebra" src="asset/zebra.jpg">
            <img id = "walkway" src="asset/walkway.jpg">
            <img id = "pedestrian" src="asset/pedestrian.jpg">
            <img id = "junction" src="asset/junction.jpg">
            <img id = "bikelane" src="asset/bikelane.jpg">
            <img id = "bikepark" src="asset/bikepark.png">
            <img id = "building" src="asset/building.jpg">
            <img id = "tree" src="asset/tree.jpg">
            <img id = "fence" src="asset/fence.jpg">
            <img id = "slides" src="asset/slides.jpg">
            <img id = "swing" src="asset/swing.jpg">
            <img id = "coffee" src="asset/coffee.jpg">
            <img id = "toy" src="asset/toy.jpg">
            <img id = "grey" src="asset/grey.jpg">
            <img id = "carpark" src="asset/carpark.jpg">
        </a-assets>
        <a-entity id="player"
            camera
            universal-controls
            static-body
            position="-85 1.8 45">
            <a-cylinder class = "player"
                player = "name: Player"
                id = "player"
                color="blue"
                collision = 0;
                aabb-collider="objects: .car, .nonbike; interval: 0"
                height="2" radius="0.3"
                static-body
                event-set__hitstart="opacity: 0.5; color: orange" 
                event-set__hitend="opacity: 1; color: blue" >
            </a-cylinder>
        </a-entity>
        <!-------------------------------------------border-------------------------->
        <a-plane src="#ground" width="10" height="100" rotation="-90 0 0" position = "-95 0 0"></a-plane>
        <a-plane src="#ground" width="10" height="100" rotation="-90 0 0" static-body position = "95 0 0"></a-plane>
        <a-plane src="#ground" width="10" height="200" rotation="-90 90 0" static-body position = "0 0 45"></a-plane>
        <a-plane src="#ground" width="10" height="200" rotation="-90 90 0" static-body position = "0 0 -45"></a-plane>
        <!-------------------------------------------walkway-------------------------->

        <a-plane src="#bikelane" width="5" height="5" rotation="-90 0 0" position = "-87.5 0.05 37.5"></a-plane>
        <a-plane color="#414d67" width="5" height="80" rotation="-90 0 0" static-body position = "-87.5 0 0"></a-plane>
        <a-plane src="#pedestrian" width="5" height="5" rotation="-90 0 0" position = "-82.5 0.05 37.5"></a-plane>
        <a-plane src="#walkway" width="5" height="24" rotation="-90 0 0" static-body position = "-82.5 0 28""></a-plane>
        <a-plane src="#walkway" width="5" height="51" rotation="-90 0 0" static-body position = "-82.5 0 -14.5"></a-plane>
        <a-plane src="#grey" width="5" height="5" rotation="-90 0 0" static-body position = "-82.5 0 13.5"></a-plane>

        <a-plane src="#walkway" width="5" height="60" rotation="-90 0 0" static-body position = "-57.5 0 10"></a-plane>
        <a-plane color="#414d67" width="5" height="60" rotation="-90 0 0" static-body position = "-52.5 0 10"></a-plane>

        <a-plane color="#414d67" width="5" height="50" rotation="-90 90 0" static-body position = "-25 0 2.5"></a-plane>
        <a-plane src="#walkway" width="5" height="10" rotation="-90 90 0" static-body position = "-45 0 7.5"></a-plane>

        <a-plane color="#414d67" width="5" height="25" rotation="-90 180 0" static-body position = "-37.5 0 17.5"></a-plane>
        <a-plane src="#walkway" width="5" height="20" rotation="-90 180 0" static-body position = "-32.5 0 15"></a-plane>

        <a-plane src="#walkway" width="5" height="20" rotation="-90 90 0" static-body position = "-20 0 22.5"></a-plane>
        <a-plane color="#414d67" width="5" height="55" rotation="-90 90 0" static-body position = "-7.5 0 27.5"></a-plane>

        <a-plane src="#walkway" width="5" height="20" rotation="-90 180 0" static-body position = "-7.5 0 15"></a-plane>
        <a-plane color="#414d67" width="5" height="20" rotation="-90 180 0" static-body position = "-2.5 0 15"></a-plane>

        <a-plane src="#walkway" width="5" height="20" rotation="-90 90 0" static-body position = "-20 0 7.5"></a-plane>
        <a-plane src="#walkway" width="5" height="10" rotation="-90 90 0" static-body position = "5 0 22.5"></a-plane>

        <a-plane src="#walkway" width="5" height="60" rotation="-90 0 0" static-body position = "-57.5 0 10"></a-plane>
        <a-plane color="#414d67" width="5" height="60" rotation="-90 0 0" static-body position = "-52.5 0 10"></a-plane>

        <a-plane src="#walkway" width="5" height="45" rotation="-90 180 0" static-body position = "12.5 0 2.5"></a-plane>
        <a-plane color="#414d67" width="5" height="35" rotation="-90 180 0" static-body position = "17.5 0 7.5"></a-plane>

        <a-plane color="#414d67" width="5" height="20" rotation="-90 90 0" static-body position = "25 0 -12.5"></a-plane>
        <a-plane src="#walkway" width="5" height="25" rotation="-90 90 0" static-body position = "27.5 0 -17.5"></a-plane>

        <a-plane src="#walkway" width="5" height="50" rotation="-90 180 0" static-body position = "37.5 0 10"></a-plane>
        <a-plane color="#414d67" width="5" height="50" rotation="-90 180 0" static-body position = "32.5 0 15"></a-plane>

        <a-plane src="#walkway" width="5" height="20" rotation="-90 90 0" static-body position = "50 0 32.5"></a-plane>
        <a-plane color="#414d67" width="5" height="25" rotation="-90 90 0" static-body position = "47.5 0 37.5"></a-plane>
        <!-------------------------------------------road-------------------------->
        <a-plane src="#zebra" width="5" height="20" rotation="-90 -90 0" position = "-70 0.05 13.5"></a-plane>
        <a-plane src="#road" width="20" height="60" rotation="-90 0 0" static-body position = "-70 0 10"></a-plane>
        <a-plane src="#junction" width="20" height="20" rotation="-90 0 0" static-body position = "-70 0 -30"></a-plane>
        <a-plane src="#road" width="20" height="10" rotation="-90 90 0" static-body position = "-55 0 -30"></a-plane>
        <a-plane src="#junction" width="20" height="40" rotation="-90 0 0" static-body position = "-40 0 -20"></a-plane>
        <a-plane src="#road" width="20" height="10" rotation="-90 90 0" static-body position = "-55 0 -30"></a-plane>
        <a-plane src="#road" width="20" height="10" rotation="-90 90 0" static-body position = "-55 0 -30"></a-plane>
        <a-plane src="#road" width="20" height="20" rotation="-90 90 0" static-body position = "-20 0 -10"></a-plane>
        <a-plane src="#junction" width="20" height="40" rotation="-90 0 0" static-body position = "0 0 -20"></a-plane>
        <a-plane src="#road" width="20" height="30" rotation="-90 90 0" static-body position = "25 0 -30"></a-plane>
        <a-plane src="#junction" width="20" height="20" rotation="-90 0 0" static-body position = "50 0 -30"></a-plane>
        <a-plane src="#road" width="20" height="30" rotation="-90 0 0" static-body position = "50 0 -5"></a-plane>
        <a-plane src="#junction" width="20" height="20" rotation="-90 0 0" static-body position = "50 0 20"></a-plane>
        <a-plane src="#road" width="20" height="10" rotation="-90 90 0" static-body position = "65 0 20"></a-plane>
        <a-plane src="#junction" width="20" height="20" rotation="-90 0 0" static-body position = "80 0 20"></a-plane>
        <a-plane src="#road" width="20" height="50" rotation="-90 0 0" static-body position = "80 0 -15"></a-plane>
        <a-plane src="#road" width="20" height="10" rotation="-90 0 0" static-body position = "80 0 35"></a-plane>
        <!-------------------------------------------scenery-------------------------->
        <a-plane src="#ground" width="20" height="20" rotation="-90 90 0" static-body position = "-20 0 -30"></a-plane>
        <a-plane src="#ground" width="10" height="50" rotation="-90 0 0" static-body position = "65 0 -15"></a-plane>
        <a-plane src="#ground" width="10" height="30" rotation="-90 0 0" static-body position = "-45 0 25"></a-plane>
        <a-plane src="#ground" width="10" height="70" rotation="-90 90 0" static-body position = "-5 0 35"></a-plane>
        <a-plane src="#ground" width="20" height="10" rotation="-90 0 0" static-body position = "-20 0 15"></a-plane>
        <a-plane src="#ground" width="20" height="10" rotation="-90 90 0" static-body position = "5 0 10"></a-plane>
        <a-plane src="#ground" width="10" height="40" rotation="-90 0 0" static-body position = "25 0 10"></a-plane>
        <a-plane src="#bikepark" width="10" height="10" rotation="-90 -90 0" static-body position = "65 0 35"></a-plane>

        <a-sky id="sky" color="#AADDF0"></a-sky>

        <!-- Lighting -->
        <a-light type="ambient" color="#ccc"></a-light>
        <!-------------------------------border obstacle------------------------->
        <a-box
            src = "#building"
            position="-95 5 27.5" width="10" height="10" depth="25"
            static-body>
        </a-box>

        <a-box
            src = "#tree"
            position="-95 2.5 5" width="5" height="5" depth="5"
            static-body>
        </a-box>

        <a-box
            src = "#tree"
            position="-95 2.5 -5" width="5" height="5" depth="5"
            static-body>
        </a-box>

        <a-box
            src = "#building"
            position="-95 5 -27.5" width="10" height="10" depth="25"
            static-body>
        </a-box>

         <a-box
            src = "#fence"
            position="-99 1 0" width="0.5" height="2" depth="30"
            static-body >
        </a-box>
        <a-box
            src = "#building"
            position="-77.5 5 -45" rotation="0 90 0" width="10" height="10" depth="25"
            static-body>
        </a-box>

        <!-------------------------------internal obstacle------------------------->
         <a-box
            src = "#slides"
            position="-23.5 2 12.5" rotation="0 90 0" width="4.5" height="5" depth="10"
            static-body>
        </a-box>
        <a-box
            src = "#swing"
            position="-15.5 2 17.5" rotation="0 90 0" width="4.5" height="5" depth="10"
            static-body>
        </a-box>
        <a-box
            src = "#tree"
            position="4.5 2.5 5.5" width="5" height="5" depth="5"
            static-body>
        </a-box>
        <a-box
            src = "#tree"
            position="4.5 2.5 15.5" width="5" height="5" depth="5"
            static-body>
        </a-box>
        <a-box
            src = "#coffee"
            position="-45.5 2.5 16" width="5" height="5" depth="10"
            static-body>
        </a-box>
        <a-box
            src = "#toy"
            position="-45.5 2.5 32" width="5" height="5" depth="10"
            static-body>
        </a-box>
        <a-box
            src = "#fence"
            position="-45 1 24" width="0.5" height="2" depth="6"
            static-body >
        </a-box>
        <a-box
            src = "#fence"
            position="0 1 50" rotation="0 90 0" width="0.5" height="2" depth="200"
            static-body >
        </a-box>
        <a-box
            src = "#fence"
            position="-99.7 1 45" width="0.5" height="2" depth="10"
            static-body >
        </a-box>
        <a-box
            src = "#tree"
            position="-95 2.5 44.5" width="7" height="5" depth="7"
            static-body>
        </a-box>
        <a-box
            src = "#grey"
            position="-70 5 45" width="20" height="10" depth="10"
            static-body>
        </a-box>
        <a-plane src="#carpark" width="20" height="10" rotation="0 180 0" static-body position = "-70 5 39.9"></a-plane>

        <!-------------------------------non bike lane------------------------->
        <a-box class = "nonbike"
            car = "name: hitbox1"
            id = "hitbox1"
            collision = 0
            material="transparent: true; opacity: 0;"
            position="-82.5 2.5 28" width="5" height="5" depth="24"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox2"
            id = "hitbox2"
            collision = 0
            material="transparent: true; opacity: 0;"
            position="-82.5 2.5 -14.5" width="5" height="5" depth="51"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox3"
            id = "hitbox3"
            collision = 0
            material="transparent: true; opacity: 0;"
            position="-58 2.5 10" width="5" height="5" depth="60"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox4"
            id = "hitbox4"
            collision = 0
            color="green" 
            material="transparent: true; opacity: 0;"
            rotation="0 90 0"
            position="-45 2.5 7.5" width="5" height="5" depth="10"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox5"
            id = "hitbox5"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            rotation="0 90 0"
            position="-20 2.5 7.5" width="5" height="5" depth="30"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox6"
            id = "hitbox6"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            rotation="0 90 0"
            position="-20 2.5 22.5" width="5" height="5" depth="30"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox7"
            id = "hitbox7"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="-32.5 2.5 15" width="5" height="5" depth="10"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox8"
            id = "hitbox8"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="-7.5 2.5 15" width="5" height="5" depth="10"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox9"
            id = "hitbox9"
            collision = 0
            color="green"
            rotation="0 90 0"
            material="transparent: true; opacity: 0;"
            position="7.5 2.5 22.5" width="5" height="5" depth="15"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox10"
            id = "hitbox10"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="12.5 2 0" width="5" height="5" depth="40"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox11"
            id = "hitbox11"
            collision = 0
            color="green"
            rotation="0 90 0"
            material="transparent: true; opacity: 0;"
            position="27.5 2 -17.5" width="5" height="5" depth="25"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox12"
            id = "hitbox12"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="37.5 2 10" width="5" height="5" depth="50"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox13"
            id = "hitbox13"
            collision = 0
            color="green"
            rotation="0 90 0"
            material="transparent: true; opacity: 0;"
            position="50 2 32.5" width="5" height="5" depth="20"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox14"
            id = "hitbox14"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="-70 2 28" width="12" height="5" depth="24"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox15"
            id = "hitbox15"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="-70 2 -12" width="12" height="5" depth="46"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox16"
            id = "hitbox16"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            rotation="0 90 0"
            position="-48.5 2 -30" width="12" height="5" depth="30"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox17"
            id = "hitbox17"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            position="-40 2 -14" width="12" height="5" depth="20"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox18"
            id = "hitbox18"
            collision = 0
            color="green"
            material="transparent: true; opacity: 0;"
            rotation="0 90 0"
            position="-14 2 -10" width="12" height="5" depth="38.5"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox19"
            id = "hitbox19"
            collision = 0
            material="transparent: true; opacity: 0;"
            color="green"
            position="-0.5 2 -26.5" width="12" height="5" depth="20"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox20"
            id = "hitbox20"
            collision = 0
            material="transparent: true; opacity: 0;"
            color="green"
            rotation="0 90 0"
            position="31 2 -30" width="12" height="5" depth="51"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox21"
            id = "hitbox21"
            collision = 0
            material="transparent: true; opacity: 0;"
            color="green"
            position="50 2 1.2" width="12" height="5" depth="50"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox22"
            id = "hitbox22"
            collision = 0
            material="transparent: true; opacity: 0;"
            color="green"
            rotation="0 90 0"
            position="65 2 20" width="12" height="5" depth="18.5"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
        <a-box class = "nonbike"
            car = "name: hitbox23"
            id = "hitbox23"
            collision = 0
            material="transparent: true; opacity: 0;"
            color="green"
            position="80 2 0" width="12" height="5" depth="80"
            event-set__hitstart="color: orange" 
            event-set__hitend="color: green" >
        </a-box>
    </a-scene>
     <script>
        document.querySelector('a-scene').addEventListener('loaded', function () {
            var MAP_SIZE = 20,
                    WALL_SIZE = 5,
                    NUM_WALL = 20;
            var platformsEl = document.querySelector('#walls');
            var v, box, animation;
            for (var i = 0;  i < NUM_WALL; i++) {
                // y: 0 is ground
                v = {
                    x: (Math.floor(Math.random() * MAP_SIZE) - WALL_SIZE) * WALL_SIZE,
                    y: WALL_SIZE / 2,
                    z: (Math.floor(Math.random() * MAP_SIZE) - WALL_SIZE) * WALL_SIZE
                };
                box = document.createElement('a-box');
                platformsEl.appendChild(box);
                var j = i+1;
                box.setAttribute('id', 'box' + j);
                box.setAttribute('color', '#39BB82');
                box.setAttribute('width', WALL_SIZE);
                box.setAttribute('height', WALL_SIZE);
                box.setAttribute('depth', WALL_SIZE);
                box.setAttribute('position', v.x + ' ' + v.y + ' ' + v.z);
                box.setAttribute('static-body', '');

                console.info("Wall no." + j);
                console.info("x:" + v.x);
                console.info("z:" + v.z);
                
                /*animation = document.createElement('a-animation');
                document.getElementById("box" + j).appendChild(animation);
                animation.setAttribute("attribute", "position");
                animation.setAttribute("dur", 3000);
                animation.setAttribute("from", v.x + ' ' + v.y + ' ' + v.z);
                animation.setAttribute("to", (v.x + 5) + ' ' + v.y + ' ' + v.z);
                animation.setAttribute("repeat", "indefinite");*/
            }
            console.info('Platforms loaded.');
            /*var car;
            car = document.createElement('a-box');
            platformsEl.appendChild(car);
            car.setAttribute('color', '#39BB82');
            car.setAttribute('width', WALL_SIZE);
            car.setAttribute('height', WALL_SIZE);
            car.setAttribute('depth', WALL_SIZE);
            car.setAttribute('position', v.x-1 + ' ' + v.y-1 + ' ' + v.z-1);
            car.setAttribute('static-body', '');
            console.info("Object created");
            console.info("x:" + v.x-1);
            console.info("z:" + v.z-1);
            while (1){
                
            }*/
        });
    </script>
</body>
</html>